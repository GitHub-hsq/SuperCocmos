# ChatGPT Web 项目开发注意事项

## 项目概述

这是一个基于 Vue 3 + TypeScript + Express 的 ChatGPT Web 应用，支持双模型（官方 API 和 Web API），提供完整的聊天界面和功能。

## 核心目录结构

```
chatgpt-web/
├── src/                    # 前端源码目录
│   ├── api/               # API 接口定义
│   ├── assets/            # 静态资源
│   ├── components/        # 组件库
│   │   ├── common/        # 通用组件
│   │   └── custom/        # 自定义组件
│   ├── hooks/             # Vue 3 Composition API hooks
│   ├── icons/             # 图标组件
│   ├── locales/           # 国际化文件
│   ├── plugins/           # 插件配置
│   ├── router/            # 路由配置
│   ├── store/             # Pinia 状态管理
│   │   └── modules/       # 状态模块
│   │       ├── app/       # 应用状态
│   │       ├── auth/      # 认证状态
│   │       ├── chat/      # 聊天状态
│   │       ├── prompt/    # 提示词状态
│   │       ├── settings/  # 设置状态
│   │       └── user/      # 用户状态
│   ├── styles/            # 样式文件
│   ├── typings/           # TypeScript 类型定义
│   ├── utils/             # 工具函数
│   └── views/             # 页面组件
│       ├── chat/          # 聊天页面
│       └── exception/     # 异常页面
├── service/               # 后端服务目录
│   ├── src/
│   │   ├── chatgpt/       # ChatGPT API 封装
│   │   ├── middleware/    # 中间件
│   │   ├── utils/         # 工具函数
│   │   └── index.ts       # 服务入口
│   └── package.json       # 后端依赖
├── public/                # 公共静态资源
├── docs/                  # 文档和图片
├── docker-compose/        # Docker 配置
└── package.json           # 前端依赖
```

## 技术栈

### 前端
- **Vue 3** - 渐进式 JavaScript 框架
- **TypeScript** - 类型安全的 JavaScript
- **Vite** - 快速构建工具
- **Pinia** - Vue 状态管理
- **Vue Router** - 路由管理
- **Naive UI** - Vue 3 组件库
- **Tailwind CSS** - 原子化 CSS 框架
- **Vue I18n** - 国际化

### 后端
- **Express** - Node.js Web 框架
- **TypeScript** - 类型安全
- **chatgpt** - ChatGPT API 封装库
- **express-rate-limit** - 请求限流

## 开发环境配置

### 1. 环境要求
- Node.js: `^16 || ^18 || ^19`
- PNPM: 包管理器

### 2. 安装依赖
```bash
# 安装前端依赖
pnpm bootstrap

# 安装后端依赖
cd service
pnpm install
```

### 3. 环境变量配置
在 `service/` 目录下创建 `.env` 文件：

```env
# OpenAI API Key (推荐方式)
OPENAI_API_KEY=your_api_key_here

# 或者使用 Web API Token
OPENAI_ACCESS_TOKEN=your_access_token_here

# 可选配置
OPENAI_API_MODEL=gpt-3.5-turbo
OPENAI_API_BASE_URL=https://api.openai.com
AUTH_SECRET_KEY=your_secret_key
MAX_REQUEST_PER_HOUR=0
TIMEOUT_MS=60000
```

### 4. 启动开发服务器
```bash
# 启动后端服务 (端口 3002)
cd service
pnpm start

# 启动前端服务 (端口 1002)
pnpm dev
```

## 核心功能模块

### 1. 聊天功能 (`src/views/chat/`)
- **主要组件**: `index.vue` - 聊天界面主组件
- **核心 Hooks**:
  - `useChat.ts` - 聊天逻辑管理
  - `useScroll.ts` - 滚动控制
  - `useUsingContext.ts` - 上下文管理
- **消息组件**: `Message/` - 消息显示和格式化

### 2. 状态管理 (`src/store/modules/`)
- **chat**: 聊天会话、消息管理
- **auth**: 用户认证状态
- **settings**: 应用设置
- **prompt**: 提示词模板管理
- **user**: 用户信息

### 3. 后端 API (`service/src/`)
- **主要接口**:
  - `POST /chat-process` - 聊天处理（流式响应）
  - `POST /config` - 获取配置
  - `POST /session` - 会话状态
  - `POST /verify` - 密钥验证

## 开发注意事项

### 1. 代码规范
- 使用 ESLint + Prettier 进行代码格式化
- 遵循 Vue 3 Composition API 最佳实践
- TypeScript 严格模式，确保类型安全
- 使用 Husky + lint-staged 进行提交前检查

### 2. 状态管理
- 使用 Pinia 进行状态管理，避免直接修改 store
- 每个模块都有对应的 helper 函数
- 使用 `storeToRefs` 解构响应式状态

### 3. 组件开发
- 优先使用 Composition API
- 组件命名使用 PascalCase
- 合理使用 `defineProps` 和 `defineEmits`
- 使用 `ref` 和 `reactive` 管理响应式数据

### 4. API 调用
- 使用 axios 进行 HTTP 请求
- 聊天接口使用流式响应，注意处理 SSE
- 错误处理要完善，给用户友好提示

### 5. 样式开发
- 使用 Tailwind CSS 原子化类名
- 自定义样式写在 `src/styles/` 目录
- 支持暗色主题切换

### 6. 国际化
- 所有文本使用 `t()` 函数进行国际化
- 新增语言在 `src/locales/` 目录添加对应文件
- 支持中文、英文、日文等多种语言

### 7. 性能优化
- 使用 `v-memo` 优化列表渲染
- 合理使用 `computed` 和 `watch`
- 图片懒加载和压缩
- 代码分割和按需加载

### 8. 安全考虑
- 设置 `AUTH_SECRET_KEY` 进行访问控制
- 使用环境变量存储敏感信息
- 实现请求限流防止滥用
- 部署时修改默认标题防止被搜索

### 9. 部署相关
- 支持 Docker 容器化部署
- 支持 Railway、Sealos 等云平台
- 前端构建后需要配置正确的 API 地址
- 生产环境建议使用 HTTPS

### 10. 调试技巧
- 使用 Vue DevTools 调试组件状态
- 后端日志会显示详细的 API 调用信息
- 网络请求可以在浏览器开发者工具中查看
- 使用 `console.log` 进行临时调试

## 常见问题解决

1. **依赖安装失败**: 确保使用 PNPM 而不是 NPM
2. **API 调用失败**: 检查环境变量配置和网络连接
3. **类型错误**: 确保 TypeScript 配置正确，使用正确的类型定义
4. **样式不生效**: 检查 Tailwind CSS 配置和类名拼写
5. **国际化不显示**: 确保在 `locales/index.ts` 中注册了对应语言

## 贡献指南

1. Fork 项目并创建功能分支
2. 遵循代码规范和提交信息格式
3. 添加必要的测试和文档
4. 提交 Pull Request

这个项目结构清晰，技术栈现代化，适合学习和二次开发。建议从聊天功能模块开始熟悉代码结构。
